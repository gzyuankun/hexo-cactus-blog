<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Redis (Remote Dictionary Server远程字典服务)是一个遵循BSD MIT开源协议的高性能的NoSQL">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis部署和基础使用">
<meta property="og:url" content="http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/index.html">
<meta property="og:site_name" content="勾三股四">
<meta property="og:description" content="Redis (Remote Dictionary Server远程字典服务)是一个遵循BSD MIT开源协议的高性能的NoSQL">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/image.assets/1670419301827.png">
<meta property="og:image" content="http://example.com/image.assets/1670419331717.png">
<meta property="og:image" content="http://example.com/image.assets/1670419470181.png">
<meta property="og:image" content="http://example.com/image.assets/1670419490780.png">
<meta property="og:image" content="http://example.com/image.assets/1670507070884.png">
<meta property="og:image" content="http://example.com/image.assets/1670853239934.png">
<meta property="og:image" content="http://example.com/image.assets/1670853325839.png">
<meta property="og:image" content="http://example.com/image.assets/1670853341364.png">
<meta property="og:image" content="http://example.com/image.assets/1670853373976.png">
<meta property="og:image" content="http://example.com/image.assets/1670853388030.png">
<meta property="og:image" content="http://example.com/image.assets/1670853405541.png">
<meta property="og:image" content="http://example.com/image.assets/1670853437912.png">
<meta property="og:image" content="http://example.com/image.assets/1670853466251.png">
<meta property="og:image" content="http://example.com/image.assets/1670853480093.png">
<meta property="og:image" content="http://example.com/image.assets/1670853532980.png">
<meta property="og:image" content="http://example.com/image.assets/1670853557144.png">
<meta property="article:published_time" content="2022-12-07T13:16:33.000Z">
<meta property="article:modified_time" content="2022-12-16T15:10:11.756Z">
<meta property="article:author" content="yuan kun">
<meta property="article:tag" content="Linux从入门到放弃">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/image.assets/1670419301827.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Redis部署和基础使用</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2022/12/13/Redis%E9%9B%86%E7%BE%A4%E5%92%8C%E9%AB%98%E5%8F%AF%E7%94%A8/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2022/12/04/%E7%BD%91%E7%BB%9C%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/&text=Redis部署和基础使用"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/&title=Redis部署和基础使用"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/&is_video=false&description=Redis部署和基础使用"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Redis部署和基础使用&body=Check out this article: http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/&title=Redis部署和基础使用"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/&title=Redis部署和基础使用"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/&title=Redis部署和基础使用"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/&title=Redis部署和基础使用"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/&name=Redis部署和基础使用&description=Redis (Remote Dictionary Server远程字典服务)是一个遵循BSD MIT开源协议的高性能的NoSQL"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/&t=Redis部署和基础使用"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">Redis基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%80%A7"><span class="toc-number">1.2.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E7%BA%BF%E7%A8%8B"><span class="toc-number">1.3.</span> <span class="toc-text">单线程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.4.</span> <span class="toc-text">常见应用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%B5%81%E7%A8%8B"><span class="toc-number">1.5.</span> <span class="toc-text">缓存的实现流程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E5%AE%89%E8%A3%85%E5%8F%8A%E8%BF%9E%E6%8E%A5"><span class="toc-number">2.</span> <span class="toc-text">Redis安装及连接</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#yum%E5%AE%89%E8%A3%85"><span class="toc-number">2.1.</span> <span class="toc-text">yum安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85"><span class="toc-number">2.2.</span> <span class="toc-text">编译安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E5%A4%9A%E5%AE%9E%E4%BE%8B"><span class="toc-number">2.3.</span> <span class="toc-text">Redis多实例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86"><span class="toc-number">3.</span> <span class="toc-text">Redis 配置管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E"><span class="toc-number">3.1.</span> <span class="toc-text">配置文件说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#config-%E5%91%BD%E4%BB%A4%E5%AE%9E%E7%8E%B0%E5%8A%A8%E6%80%81%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.</span> <span class="toc-text">config 命令实现动态修改配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5%E5%AF%86%E7%A0%81"><span class="toc-number">3.2.1.</span> <span class="toc-text">设置客户端连接密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.2.</span> <span class="toc-text">获取当前配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AERedis%E4%BD%BF%E7%94%A8%E7%9A%84%E6%9C%80%E5%A4%A7%E5%86%85%E5%AD%98%E9%87%8F"><span class="toc-number">3.2.3.</span> <span class="toc-text">设置Redis使用的最大内存量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.2.4.</span> <span class="toc-text">慢查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">3.2.5.</span> <span class="toc-text">Redis持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RDB"><span class="toc-number">3.2.5.1.</span> <span class="toc-text">RDB</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.5.2.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF"><span class="toc-number">3.2.5.3.</span> <span class="toc-text">AOF</span></a></li></ol></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Redis部署和基础使用
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">yuankun</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-12-07T13:16:33.000Z" itemprop="datePublished">2022-12-07</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/Redis%E5%9F%BA%E7%A1%80/">Redis基础</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/Linux%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/" rel="tag">Linux从入门到放弃</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="Redis基础"><a href="#Redis基础" class="headerlink" title="Redis基础"></a>Redis基础</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Redis (Remote Dictionary Server远程字典服务)是一个遵循BSD MIT开源协议的高性能的NoSQL.Redis基于ANSI C语言语言)编写的key-value数据库,是意大利的Salvatore Sanfilippo在2009年发布，从2010年3月15日起，Redis的开发工作由VMware主持。从2013年5月开始，Redis的开发由Pivotal公司赞助。目前国内外使用的公司众多,比如:阿里,腾讯,百度,京东,新浪微博,GitHub,Twitter 等Redis的出现，很大程度补偿了memcached这类key&#x2F;value存储的不足，在部分场合可以对关系数据库起到很好的补充作用。它提供了Java，C&#x2F;C++，Go, C#，PHP，JavaScript，Perl，Object-C，Python，Ruby，Erlang等客户端<br>DB-Engine月度排行榜Redis在键值型存储类的数据库长期居于首位,远远高于第二位的memcached</p>
<h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ul>
<li>速度快: 10W QPS,基于内存,C语言实现</li>
<li>单线程</li>
<li>持久化</li>
<li>支持多种数据结构</li>
<li>支持多种编程语言</li>
<li>功能丰富: 支持Lua脚本,发布订阅,事务,pipeline等功能</li>
<li>简单: 代码短小精悍(单机核心代码只有23000行左右),单线程开发容易,不依赖外部库,使用简单</li>
<li>主从复制</li>
<li>支持高可用和分布式</li>
</ul>
<h2 id="单线程"><a href="#单线程" class="headerlink" title="单线程"></a>单线程</h2><p>Redis 6.0版本前一直是单线程方式处理用户的请求</p>
<p><img src="/../image.assets/1670419301827.png" alt="1670419301827"></p>
<p>单线程为何如此快?</p>
<ul>
<li>纯内存</li>
<li>非阻塞避免线程切换和竞态消耗</li>
</ul>
<p><img src="/../image.assets/1670419331717.png" alt="1670419331717"></p>
<p>注意事项</p>
<ul>
<li>一次只运行一条命令</li>
<li>避免执行长(慢)命令:keys *, flushall, flushdb, slow lua script, mutil&#x2F;exec, operate bigvalue(collection)</li>
<li>其实不是单线程: 早期版本是单进程单线程,3.0 版本后实际还有其它的线程, 实现特定功能,如: fysnc file descriptor,close file descriptor</li>
</ul>
<h2 id="常见应用场景"><a href="#常见应用场景" class="headerlink" title="常见应用场景"></a>常见应用场景</h2><ul>
<li>缓存：缓存RDBMS中数据,比如网站的查询结果、商品信息、微博、新闻、消息</li>
<li>Session 共享：实现Web集群中的多服务器间的session共享</li>
<li>计数器：商品访问排行榜、浏览数、粉丝数、关注、点赞、评论等和次数相关的数值统计场景</li>
<li>社交：朋友圈、共同好友、可能认识他们等</li>
<li>地理位置: 基于地理信息系统GIS（Geographic Information System)实现摇一摇、附近的人、外卖等功能</li>
<li>消息队列：ELK等日志系统缓存、业务的订阅&#x2F;发布系统</li>
</ul>
<h2 id="缓存的实现流程"><a href="#缓存的实现流程" class="headerlink" title="缓存的实现流程"></a>缓存的实现流程</h2><p>数据更新操作流程：</p>
<p><img src="/../image.assets/1670419470181.png" alt="1670419470181"></p>
<p>数据读操作流程：</p>
<p><img src="/../image.assets/1670419490780.png" alt="1670419490780"></p>
<h1 id="Redis安装及连接"><a href="#Redis安装及连接" class="headerlink" title="Redis安装及连接"></a>Redis安装及连接</h1><p>官网下载地址</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://download.redis.io/releases/</span><br></pre></td></tr></table></figure>

<h2 id="yum安装"><a href="#yum安装" class="headerlink" title="yum安装"></a>yum安装</h2><p>查看yum库redis版本</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum info redis   或者  yum info redis</span><br></pre></td></tr></table></figure>

<p>yum 安装 redis</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">yum install -y redis</span><br><span class="line"># 启动</span><br><span class="line">systemctl enable --now redis</span><br><span class="line"></span><br><span class="line"># 连接</span><br><span class="line">[root@centos8-backup www]# redis-cli</span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line"></span><br><span class="line"># 查看信息</span><br><span class="line">127.0.0.1:6379&gt; info</span><br><span class="line"># Server</span><br><span class="line">redis_version:5.0.3</span><br><span class="line">redis_git_sha1:00000000</span><br><span class="line">redis_git_dirty:0</span><br><span class="line">redis_build_id:9529b692c0384fb7</span><br><span class="line">redis_mode:standalone</span><br><span class="line">os:Linux 4.18.0-348.7.1.el8_5.x86_64 x86_64</span><br><span class="line">arch_bits:64</span><br><span class="line">multiplexing_api:epoll</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<h2 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h2><ul>
<li>Redis源码包下载地址</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://download.redis.io/releases/</span><br></pre></td></tr></table></figure>

<ul>
<li>下载源码包</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7-master ~]# wget http://download.redis.io/releases/redis-6.2.6.tar.gz</span><br><span class="line">[root@centos7-master ~]# tar xf redis-6.2.6.tar.gz</span><br></pre></td></tr></table></figure>

<ul>
<li>安装依赖</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># centos</span><br><span class="line">[root@centos7-master ~]# yum -y install gcc jemalloc-devel systemd-devel</span><br><span class="line"># ubuntu</span><br><span class="line">apt -y install make gcc libjemalloc-dev libsystemd-dev</span><br></pre></td></tr></table></figure>

<ul>
<li>编译安装</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7-master ~]# cd redis-6.2.6</span><br><span class="line">#如果支持systemd,需要执行下面</span><br><span class="line">[root@centos7-master redis-6.2.6]# make -j 2 USE_SYSTEMD=yes PREFIX=/usr/local/src/redis  install</span><br><span class="line"></span><br><span class="line"># 配置环境变量</span><br><span class="line">[root@centos7-master ~]# echo &#x27;PATH=/usr/local/src/redis/bin:$PATH&#x27; &gt; /etc/profile.d/redis.sh</span><br><span class="line">[root@centos7-master ~]# </span><br><span class="line">[root@centos7-master ~]# . /etc/profile.d/redis.sh</span><br><span class="line">[root@centos7-master ~]# </span><br><span class="line"></span><br><span class="line">#准备相关目录和配置文件</span><br><span class="line">#创建配置文件、日志、数据等目录</span><br><span class="line">[root@centos7-master redis]# mkdir /usr/local/src/redis/&#123;etc,log,data,run&#125;</span><br><span class="line">[root@centos7-master redis-6.2.6]# cp redis.conf /usr/local/src/redis/etc/</span><br></pre></td></tr></table></figure>

<ul>
<li>修改配置文件</li>
</ul>
<p>logfile  “&#x2F;usr&#x2F;local&#x2F;src&#x2F;redis&#x2F;log&#x2F;redis_6379.log”</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Specify the log file name. Also the empty string can be used to force</span><br><span class="line"># Redis to log on the standard output. Note that if you use standard</span><br><span class="line"># output for logging but daemonize, logs will be sent to /dev/null</span><br><span class="line">logfile &quot;/usr/local/src/redis/log/redis_6379.log&quot;</span><br><span class="line"></span><br><span class="line"># To enable logging to the system logger, just set &#x27;syslog-enabled&#x27; to yes,</span><br><span class="line"># and optionally update the other syslog parameters to suit your needs.</span><br><span class="line"># syslog-enabled no</span><br><span class="line"></span><br><span class="line"># Specify the syslog identity.</span><br><span class="line"># syslog-ident redis</span><br></pre></td></tr></table></figure>

<p>pidfile &#x2F;usr&#x2F;local&#x2F;src&#x2F;redis&#x2F;run&#x2F;redis_6379.pid</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Note that on modern Linux systems &quot;/run/redis.pid&quot; is more conforming</span><br><span class="line"># and should be used instead.</span><br><span class="line">#pidfile /var/run/redis_6379.pid</span><br><span class="line">pidfile /usr/local/src/redis/run/redis_6379.pid</span><br><span class="line"></span><br><span class="line"># Specify the server verbosity level.</span><br><span class="line"># This can be one of:</span><br><span class="line"># debug (a lot of information, useful for development/testing)</span><br><span class="line"># verbose (many rarely useful info, but not a mess like the debug level)</span><br><span class="line"># notice (moderately verbose, what you want in production probably)</span><br><span class="line"># warning (only very important / critical messages are logged)</span><br><span class="line">loglevel notice</span><br></pre></td></tr></table></figure>

<p>dir “&#x2F;usr&#x2F;local&#x2F;src&#x2F;redis&#x2F;data&#x2F;6379”</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Note that you must specify a directory here, not a file name.</span><br><span class="line">dir &quot;/usr/local/src/redis/data/6379&quot;</span><br><span class="line"></span><br><span class="line">################################# REPLICATION #################################</span><br><span class="line"></span><br><span class="line"># Master-Replica replication. Use replicaof to make a Redis instance a copy of</span><br><span class="line"># another Redis server. A few things to understand ASAP about Redis replication.</span><br></pre></td></tr></table></figure>

<p>dbfilename ‘dump.rdb’</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># sanitize-dump-payload no</span><br><span class="line"></span><br><span class="line"># The filename where to dump the DB</span><br><span class="line">dbfilename &#x27;dump.rdb&#x27;</span><br></pre></td></tr></table></figure>

<ul>
<li>前台启动redis</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7-master ~]# redis-server /usr/local/src/redis/etc/redis.conf </span><br><span class="line">51487:C 07 Dec 2022 22:27:26.620 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span><br><span class="line">51487:C 07 Dec 2022 22:27:26.620 # Redis version=6.2.6, bits=64, commit=00000000, modified=0, pid=51487, just started</span><br><span class="line">51487:C 07 Dec 2022 22:27:26.620 # Configuration loaded</span><br><span class="line">51487:M 07 Dec 2022 22:27:26.620 * Increased maximum number of open files to 10032 (it was originally set to 1024).</span><br><span class="line">51487:M 07 Dec 2022 22:27:26.620 * monotonic clock: POSIX clock_gettime</span><br><span class="line">                _._                                                  </span><br><span class="line">           _.-``__ &#x27;&#x27;-._                                             </span><br><span class="line">      _.-``    `.  `_.  &#x27;&#x27;-._           Redis 6.2.6 (00000000/0) 64 bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ &#x27;&#x27;-._                                  </span><br><span class="line"> (    &#x27;      ,       .-`  | `,    )     Running in standalone mode</span><br><span class="line"> |`-._`-...-` __...-.``-._|&#x27;` _.-&#x27;|     Port: 6379</span><br><span class="line"> |    `-._   `._    /     _.-&#x27;    |     PID: 51487</span><br><span class="line">  `-._    `-._  `-./  _.-&#x27;    _.-&#x27;                                   </span><br><span class="line"> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|                                  </span><br><span class="line"> |    `-._`-._        _.-&#x27;_.-&#x27;    |           https://redis.io       </span><br><span class="line">  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;                                   </span><br><span class="line"> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|                                  </span><br><span class="line"> |    `-._`-._        _.-&#x27;_.-&#x27;    |                                  </span><br><span class="line">  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;                                   </span><br><span class="line">      `-._    `-.__.-&#x27;    _.-&#x27;                                       </span><br><span class="line">          `-._        _.-&#x27;                                           </span><br><span class="line">              `-.__.-&#x27;                                               </span><br><span class="line"></span><br><span class="line">51487:M 07 Dec 2022 22:27:26.621 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span><br><span class="line">51487:M 07 Dec 2022 22:27:26.621 # Server initialized</span><br><span class="line">51487:M 07 Dec 2022 22:27:26.621 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &#x27;vm.overcommit_memory = 1&#x27; to /etc/sysctl.conf and then reboot or run the command &#x27;sysctl vm.overcommit_memory=1&#x27; for this to take effect.</span><br><span class="line">51487:M 07 Dec 2022 22:27:26.621 * Ready to accept connections</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>帮助</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7-master ~]# redis-server -h</span><br><span class="line">Usage: ./redis-server [/path/to/redis.conf] [options] [-]</span><br><span class="line">       ./redis-server - (read config from stdin)</span><br><span class="line">       ./redis-server -v or --version</span><br><span class="line">       ./redis-server -h or --help</span><br><span class="line">       ./redis-server --test-memory &lt;megabytes&gt;</span><br><span class="line"></span><br><span class="line">Examples:</span><br><span class="line">       ./redis-server (run the server with default conf)</span><br><span class="line">       ./redis-server /etc/redis/6379.conf</span><br><span class="line">       ./redis-server --port 7777</span><br><span class="line">       ./redis-server --port 7777 --replicaof 127.0.0.1 8888</span><br><span class="line">       ./redis-server /etc/myredis.conf --loglevel verbose -</span><br><span class="line">       ./redis-server /etc/myredis.conf --loglevel verbose</span><br><span class="line"></span><br><span class="line">Sentinel mode:</span><br><span class="line">       ./redis-server /etc/sentinel.conf --sentinel</span><br><span class="line">[root@centos7-master ~]# </span><br></pre></td></tr></table></figure>

<ul>
<li>消除启动时的三个Warning提示信息(可选)</li>
</ul>
<p>Tcp backlog</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WARNING: The TCP backlog setting of 511 cannot be enforced because</span><br><span class="line">/proc/sys/net/core/somaxconn is set to the lower value of 128.</span><br></pre></td></tr></table></figure>

<p>Tcp backlog 是指TCP的第三次握手服务器端收到客户端 ack确认号之后到服务器用Accept函数处理请求前的队列长度，即全连接队列</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#vim /etc/sysctl.conf</span><br><span class="line">net.core.somaxconn = 511</span><br><span class="line">#sysctl -p</span><br></pre></td></tr></table></figure>

<p> overcommit_memory</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">WARNING overcommit_memory is set to 0! Background save may fail under low memory</span><br><span class="line">condition. To fix this issue add &#x27;vm.overcommit_memory = 1&#x27; to /etc/sysctl.conf</span><br><span class="line">and then reboot or run the command &#x27;sysctl vm.overcommit_memory=1&#x27; for this to</span><br><span class="line">take effect.</span><br></pre></td></tr></table></figure>

<p>内核参数说明</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">内核参数overcommit_memory 实现内存分配策略,可选值有三个：0、1、2</span><br><span class="line">0 表示内核将检查是否有足够的可用内存供应用进程使用；如果有足够的可用内存，内存申请允许；否则内存</span><br><span class="line">申请失败，并把错误返回给应用进程</span><br><span class="line">1 表示内核允许分配所有的物理内存，而不管当前的内存状态如何</span><br><span class="line">2 表示内核允许分配超过所有物理内存和交换空间总和的内存</span><br></pre></td></tr></table></figure>

<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#vim /etc/sysctl.conf</span><br><span class="line">vm.overcommit_memory = 1</span><br><span class="line">#sysctl -p</span><br></pre></td></tr></table></figure>

<p>transparent hugepage</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">WARNING you have Transparent Huge Pages (THP) support enabled in your kernel.</span><br><span class="line">This will create latency and memory usage issues with Redis. To fix this issue</span><br><span class="line">run the command &#x27;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#x27; as</span><br><span class="line">root, and add it to your /etc/rc.local in order to retain the setting after a</span><br><span class="line">reboot. Redis must be restarted after THP is disabled.</span><br><span class="line">警告：您在内核中启用了透明大页面（THP,不同于一般4k内存页,而为2M）支持。 这将在Redis中造成延迟</span><br><span class="line">和内存使用问题。 要解决此问题，请以root 用户身份运行命令“echo never&gt;</span><br><span class="line">/sys/kernel/mm/transparent_hugepage/enabled”，并将其添加到您的/etc/rc.local中，以便在</span><br><span class="line">重启后保留设置。禁用THP后，必须重新启动Redis。</span><br></pre></td></tr></table></figure>

<p>注意：ubuntu20.04, Rocky8&#x2F;CentOS8 默认为 never，所以此值无需优化</p>
<p>验证是否消除warning</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7-master ~]# redis-server /usr/local/src/redis/etc/redis.conf </span><br><span class="line">51540:C 07 Dec 2022 22:38:45.196 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span><br><span class="line">51540:C 07 Dec 2022 22:38:45.196 # Redis version=6.2.6, bits=64, commit=00000000, modified=0, pid=51540, just started</span><br><span class="line">51540:C 07 Dec 2022 22:38:45.196 # Configuration loaded</span><br><span class="line">51540:M 07 Dec 2022 22:38:45.197 * Increased maximum number of open files to 10032 (it was originally set to 1024).</span><br><span class="line">51540:M 07 Dec 2022 22:38:45.197 * monotonic clock: POSIX clock_gettime</span><br><span class="line">                _._                                                  </span><br><span class="line">           _.-``__ &#x27;&#x27;-._                                             </span><br><span class="line">      _.-``    `.  `_.  &#x27;&#x27;-._           Redis 6.2.6 (00000000/0) 64 bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ &#x27;&#x27;-._                                  </span><br><span class="line"> (    &#x27;      ,       .-`  | `,    )     Running in standalone mode</span><br><span class="line"> |`-._`-...-` __...-.``-._|&#x27;` _.-&#x27;|     Port: 6379</span><br><span class="line"> |    `-._   `._    /     _.-&#x27;    |     PID: 51540</span><br><span class="line">  `-._    `-._  `-./  _.-&#x27;    _.-&#x27;                                   </span><br><span class="line"> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|                                  </span><br><span class="line"> |    `-._`-._        _.-&#x27;_.-&#x27;    |           https://redis.io       </span><br><span class="line">  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;                                   </span><br><span class="line"> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|                                  </span><br><span class="line"> |    `-._`-._        _.-&#x27;_.-&#x27;    |                                  </span><br><span class="line">  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;                                   </span><br><span class="line">      `-._    `-.__.-&#x27;    _.-&#x27;                                       </span><br><span class="line">          `-._        _.-&#x27;                                           </span><br><span class="line">              `-.__.-&#x27;                                               </span><br><span class="line"></span><br><span class="line">51540:M 07 Dec 2022 22:38:45.197 # Server initialized</span><br><span class="line">51540:M 07 Dec 2022 22:38:45.198 * Loading RDB produced by version 6.2.6</span><br><span class="line">51540:M 07 Dec 2022 22:38:45.198 * RDB age 2 seconds</span><br><span class="line">51540:M 07 Dec 2022 22:38:45.198 * RDB memory usage when created 0.77 Mb</span><br><span class="line">51540:M 07 Dec 2022 22:38:45.198 # Done loading RDB, keys loaded: 0, keys expired: 0.</span><br><span class="line">51540:M 07 Dec 2022 22:38:45.198 * DB loaded from disk: 0.000 seconds</span><br><span class="line">51540:M 07 Dec 2022 22:38:45.198 * Ready to accept connections</span><br></pre></td></tr></table></figure>

<ul>
<li>创建 Redis 用户和设置数据目录权限</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7-master ~]# useradd -r -s /sbin/nologin redis</span><br><span class="line">[root@centos7-master ~]# chown -R  redis.redis /usr/local/src/redis/</span><br><span class="line">[root@centos7-master ~]# </span><br></pre></td></tr></table></figure>

<ul>
<li>创建 Redis 服务 Service 文件</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7-master ~]# vim /lib/systemd/system/redis.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Redis persistent key-value database</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/local/src/redis/bin/redis-server /usr/local/src/redis/etc/redis.conf --supervised systemd</span><br><span class="line">ExecStop=/bin/kill -s QUIT $MAINPID</span><br><span class="line">Type=notify </span><br><span class="line">User=redis</span><br><span class="line">Group=redis</span><br><span class="line">RuntimeDirectory=redis</span><br><span class="line">RuntimeDirectoryMode=0755</span><br><span class="line">LimitNOFILE=1000000 </span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<ul>
<li>Redis 通过Service方式启动</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart redis</span><br><span class="line">systemctl status redis</span><br></pre></td></tr></table></figure>

<h2 id="Redis多实例"><a href="#Redis多实例" class="headerlink" title="Redis多实例"></a>Redis多实例</h2><p>基于源码编译安装的前提下实现redis的多实例</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"># 进入/usr/local/src/redis/etc</span><br><span class="line">[root@centos7-master ~]# cd /usr/local/src/redis/etc/</span><br><span class="line">[root@centos7-master etc]# </span><br><span class="line"></span><br><span class="line"># 修改配置文件，使用6380,6381端口启动实例</span><br><span class="line">[root@centos7-master etc]# sed &#x27;s/6379/6380/&#x27; redis.conf &gt; redis6380.conf</span><br><span class="line">[root@centos7-master etc]# sed &#x27;s/6379/6380/&#x27; redis.conf &gt; redis6381.conf</span><br><span class="line"></span><br><span class="line"># 修改所属组</span><br><span class="line">[root@centos7-master etc]# chown -R redis.redis *</span><br><span class="line"></span><br><span class="line"># 修改启动文件</span><br><span class="line">[root@centos7-master etc]# cp /lib/systemd/system/redis.service /lib/systemd/system/redis6380.service </span><br><span class="line">[root@centos7-master etc]# </span><br><span class="line"></span><br><span class="line">[root@centos7-master etc]# vim /lib/systemd/system/redis6380.service </span><br><span class="line">[Unit]</span><br><span class="line">Description=Redis persistent key-value database</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/local/src/redis/bin/redis-server /usr/local/src/redis/etc/redis6380.conf --supervised systemd</span><br><span class="line">ExecStop=/bin/kill -s QUIT $MAINPID</span><br><span class="line">Type=notify</span><br><span class="line">User=redis</span><br><span class="line">Group=redis</span><br><span class="line">RuntimeDirectory=redis</span><br><span class="line">RuntimeDirectoryMode=0755</span><br><span class="line">LimitNOFILE=1000000</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"># 使用相同方法创建/lib/systemd/system/redis6381.service文件并修改内容</span><br><span class="line"></span><br><span class="line"># 启动实例</span><br><span class="line">[root@centos7-master etc]# systemctl status redis.service</span><br><span class="line">[root@centos7-master etc]# systemctl status redis6380.service</span><br><span class="line">[root@centos7-master etc]# systemctl status redis6381.service</span><br><span class="line"></span><br><span class="line"># 查看6379 6380 6381 端口是否启用</span><br></pre></td></tr></table></figure>

<p><img src="/../image.assets/1670507070884.png" alt="1670507070884"></p>
<ul>
<li>连接测试</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7-master etc]# redis-cli -p 6379</span><br><span class="line">[root@centos7-master etc]# redis-cli -p 6380</span><br><span class="line">[root@centos7-master etc]# redis-cli -p 6381</span><br></pre></td></tr></table></figure>

<h1 id="Redis-配置管理"><a href="#Redis-配置管理" class="headerlink" title="Redis 配置管理"></a>Redis 配置管理</h1><h2 id="配置文件说明"><a href="#配置文件说明" class="headerlink" title="配置文件说明"></a>配置文件说明</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">bind 0.0.0.0 #指定监听地址，支持用空格隔开的多个监听IP</span><br><span class="line">protected-mode yes #redis3.2之后加入的新特性，在没有设置bind IP和密码的时候,redis只允许访</span><br><span class="line">问127.0.0.1:6379，可以远程连接，但当访问将提示警告信息并拒绝远程访问</span><br><span class="line">port 6379 #监听端口,默认6379/tcp</span><br><span class="line">tcp-backlog 511 #三次握手的时候server端收到client ack确认号之后的队列值，即全连接队列长度</span><br><span class="line">timeout 0 #客户端和Redis服务端的连接超时时间，默认是0，表示永不超时</span><br><span class="line">tcp-keepalive 300 #tcp 会话保持时间300s</span><br><span class="line">daemonize no #默认no,即直接运行redis-server程序时,不作为守护进程运行，而是以前台方式运行，</span><br><span class="line">如果想在后台运行需改成yes,当redis作为守护进程运行的时候，它会写一个 pid 到</span><br><span class="line">/var/run/redis.pid 文件</span><br><span class="line">supervised no #和OS相关参数，可设置通过upstart和systemd管理Redis守护进程，centos7后都使</span><br><span class="line">用systemd</span><br><span class="line">pidfile /var/run/redis_6379.pid #pid文件路径,可以修改</span><br><span class="line">为/apps/redis/run/redis_6379.pid</span><br><span class="line">loglevel notice #日志级别</span><br><span class="line">logfile &quot;/path/redis.log&quot; #日志路径,示例:logfile &quot;/apps/redis/log/redis_6379.log&quot;</span><br><span class="line">databases 16 #设置数据库数量，默认：0-15，共16个库</span><br><span class="line">always-show-logo yes #在启动redis 时是否显示或在日志中记录记录redis的logo</span><br></pre></td></tr></table></figure>

<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">save 900 1 #在900秒内有1个key内容发生更改,就执行快照机制</span><br><span class="line">save 300 10 #在300秒内有10个key内容发生更改,就执行快照机制</span><br><span class="line">save 60 10000 #60秒内如果有10000个key以上的变化，就自动快照备份</span><br><span class="line">stop-writes-on-bgsave-error yes #默认为yes时,可能会因空间满等原因快照无法保存出错时，会禁</span><br><span class="line">止redis写入操作，生产建议为no</span><br><span class="line">#此项只针对配置文件中的自动save有效</span><br><span class="line">rdbcompression yes #持久化到RDB文件时，是否压缩，&quot;yes&quot;为压缩，&quot;no&quot;则反之</span><br><span class="line">rdbchecksum yes #是否对备份文件开启RC64校验，默认是开启</span><br><span class="line">dbfilename dump.rdb #快照文件名</span><br><span class="line">dir ./ #快照文件保存路径，示例：dir &quot;/apps/redis/data&quot;</span><br><span class="line">#主从复制相关</span><br><span class="line"># replicaof &lt;masterip&gt; &lt;masterport&gt; #指定复制的master主机地址和端口，5.0版之前的指令为</span><br><span class="line">slaveof</span><br><span class="line"># masterauth &lt;master-password&gt; #指定复制的master主机的密码</span><br><span class="line">replica-serve-stale-data yes #当从库同主库失去连接或者复制正在进行，从机库有两种运行方式：</span><br><span class="line">1、设置为yes(默认设置)，从库会继续响应客户端的读请求，此为建议值</span><br><span class="line">2、设置为no，除去特定命令外的任何请求都会返回一个错误&quot;SYNC with master in progress&quot;。</span><br><span class="line">replica-read-only yes #是否设置从库只读，建议值为yes,否则主库同步从库时可能会覆盖数据，造成</span><br><span class="line">数据丢失</span><br><span class="line">repl-diskless-sync no #是否使用socket方式复制数据(无盘同步)，新slave第一次连接master时需</span><br><span class="line">要做数据的全量同步，redis server就要从内存dump出新的RDB文件，然后从master传到slave，有两种</span><br><span class="line">方式把RDB文件传输给客户端：</span><br><span class="line">1、基于硬盘（disk-backed）：为no时，master创建一个新进程dump生成RDB磁盘文件，RDB完成之后由</span><br><span class="line">父进程（即主进程）将RDB文件发送给slaves，此为默认值</span><br><span class="line">2、基于socket（diskless）：master创建一个新进程直接dump RDB至slave的网络socket，不经过主</span><br><span class="line">进程和硬盘</span><br><span class="line">#推荐使用基于硬盘（为no），是因为RDB文件创建后，可以同时传输给更多的slave，但是基于socket(为</span><br><span class="line">yes)， 新slave连接到master之后得逐个同步数据。只有当磁盘I/O较慢且网络较快时，可用</span><br><span class="line">diskless(yes),否则一般建议使用磁盘(no)</span><br><span class="line">repl-diskless-sync-delay 5 #diskless时复制的服务器等待的延迟时间，设置0为关闭，在延迟时间</span><br><span class="line">内到达的客户端，会一起通过diskless方式同步数据，但是一旦复制开始，master节点不会再接收新slave</span><br><span class="line">的复制请求，直到下一次同步开始才再接收新请求。即无法为延迟时间后到达的新副本提供服务，新副本将排</span><br><span class="line">队等待下一次RDB传输，因此服务器会等待一段时间才能让更多副本到达。推荐值：30-60</span><br><span class="line">repl-ping-replica-period 10 #slave根据master指定的时间进行周期性的PING master,用于监测</span><br><span class="line">master状态,默认10s</span><br><span class="line">repl-timeout 60 #复制连接的超时时间，需要大于repl-ping-slave-period，否则会经常报超时</span><br><span class="line">repl-disable-tcp-nodelay no #是否在slave套接字发送SYNC之后禁用 TCP_NODELAY，如果选</span><br><span class="line">择&quot;yes&quot;，Redis将合并多个报文为一个大的报文，从而使用更少数量的包向slaves发送数据，但是将使数据</span><br><span class="line">传输到slave上有延迟，Linux内核的默认配置会达到40毫秒，如果 &quot;no&quot; ，数据传输到slave的延迟将会</span><br><span class="line">减少，但要使用更多的带宽</span><br><span class="line">repl-backlog-size 512mb #复制缓冲区内存大小，当slave断开连接一段时间后，该缓冲区会累积复制</span><br><span class="line">副本数据，因此当slave 重新连接时，通常不需要完全重新同步，只需传递在副本中的断开连接后没有同步的</span><br><span class="line">部分数据即可。只有在至少有一个slave连接之后才分配此内存空间,建议建立主从时此值要调大一些或在低峰</span><br><span class="line">期配置,否则会导致同步到slave失败</span><br></pre></td></tr></table></figure>

<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">repl-backlog-ttl 3600 #多长时间内master没有slave连接，就清空backlog缓冲区</span><br><span class="line">replica-priority 100 #当master不可用，哨兵Sentinel会根据slave的优先级选举一个master，此</span><br><span class="line">值最低的slave会优先当选master，而配置成0，永远不会被选举，一般多个slave都设为一样的值，让其自</span><br><span class="line">动选择</span><br><span class="line">#min-replicas-to-write 3 #至少有3个可连接的slave，mater才接受写操作</span><br><span class="line">#min-replicas-max-lag 10 #和上面至少3个slave的ping延迟不能超过10秒，否则master也将停止</span><br><span class="line">写操作</span><br><span class="line">requirepass foobared #设置redis连接密码，之后需要AUTH pass,如果有特殊符号，用&quot; &quot;引起来,生</span><br><span class="line">产建议设置</span><br><span class="line">rename-command #重命名一些高危命令，示例：rename-command FLUSHALL &quot;&quot; 禁用命令</span><br><span class="line">#示例: rename-command del magedu</span><br><span class="line">maxclients 10000 #Redis最大连接客户端</span><br><span class="line">maxmemory &lt;bytes&gt; #redis使用的最大内存，单位为bytes字节，0为不限制，建议设为物理内存一半，</span><br><span class="line">8G内存的计算方式8(G)*1024(MB)1024(KB)*1024(Kbyte)，需要注意的是缓冲区是不计算在maxmemory</span><br><span class="line">内,生产中如果不设置此项,可能会导致OOM</span><br><span class="line">#maxmemory-policy noeviction 此为默认值</span><br><span class="line"># MAXMEMORY POLICY：当达到最大内存时，Redis 将如何选择要删除的内容。您可以从以下行为中选择一</span><br><span class="line">种：</span><br><span class="line">#</span><br><span class="line"># volatile-lru -&gt; Evict 使用近似 LRU，只有设置了过期时间的键。</span><br><span class="line"># allkeys-lru -&gt; 使用近似 LRU 驱逐任何键。</span><br><span class="line"># volatile-lfu -&gt; 使用近似 LFU 驱逐，只有设置了过期时间的键。</span><br><span class="line"># allkeys-lfu -&gt; 使用近似 LFU 驱逐任何键。</span><br><span class="line"># volatile-random -&gt; 删除设置了过期时间的随机密钥。</span><br><span class="line"># allkeys-random -&gt; 删除一个随机密钥，任何密钥。</span><br><span class="line"># volatile-ttl -&gt; 删除过期时间最近的key（次TTL）</span><br><span class="line"># noeviction -&gt; 不要驱逐任何东西，只是在写操作时返回一个错误。</span><br><span class="line">#</span><br><span class="line"># LRU 表示最近最少使用</span><br><span class="line"># LFU 表示最不常用</span><br><span class="line">#</span><br><span class="line"># LRU、LFU 和 volatile-ttl 都是使用近似随机算法实现的。</span><br><span class="line">#</span><br><span class="line"># 注意：使用上述任何一种策略，当没有合适的键用于驱逐时，Redis 将在需要更多内存的写操作时返回错</span><br><span class="line">误。这些通常是创建新密钥、添加数据或修改现有密钥的命令。一些示例是：SET、INCR、HSET、LPUSH、</span><br><span class="line">SUNIONSTORE、SORT（由于 STORE 参数）和 EXEC（如果事务包括任何需要内存的命令）。</span><br><span class="line">#MAXMEMORY POLICY：当达到最大内存时，Redis 将如何选择要删除的内容。可以从下面行为中进行选</span><br><span class="line">择：</span><br><span class="line"># volatile-lru -&gt; 在具有过期集的键中使用近似 LRU 驱逐。</span><br><span class="line"># allkeys-lru -&gt; 使用近似 LRU 驱逐任何键。</span><br><span class="line"># volatile-lfu -&gt; 在具有过期集的键中使用近似 LFU 驱逐。</span><br><span class="line"># allkeys-lfu -&gt; 使用近似 LFU 驱逐任何键。</span><br><span class="line"># volatile-random -&gt; 从具有过期设置的密钥中删除一个随机密钥。</span><br><span class="line"># allkeys-random -&gt; 删除一个随机密钥，任何密钥。</span><br><span class="line"># volatile-ttl -&gt; 删除过期时间最近的key（次TTL）</span><br><span class="line"># noeviction -&gt; 不要驱逐任何东西，只是在写操作时返回一个错误。</span><br><span class="line">#</span><br><span class="line"># LRU 表示最近最少使用</span><br></pre></td></tr></table></figure>

<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"># LFU 表示最不常用</span><br><span class="line">#</span><br><span class="line"># LRU、LFU 和 volatile-ttl 均使用近似实现随机算法。</span><br><span class="line">#</span><br><span class="line"># 注意：使用上述任何一种策略，Redis 都会在写入时返回错误操作，当没有合适的键用于驱逐时。</span><br><span class="line">appendonly no #是否开启AOF日志记录，默认redis使用的是rdb方式持久化，这种方式在许多应用中已经</span><br><span class="line">足够用了，但是redis如果中途宕机，会导致可能有几分钟的数据丢失(取决于dump数据的间隔时间)，根据</span><br><span class="line">save来策略进行持久化，Append Only File是另一种持久化方式，可以提供更好的持久化特性，Redis会</span><br><span class="line">把每次写入的数据在接收后都写入 appendonly.aof 文件，每次启动时Redis都会先把这个文件的数据读入</span><br><span class="line">内存里，先忽略RDB文件。默认不启用此功能</span><br><span class="line">appendfilename &quot;appendonly.aof&quot; #文本文件AOF的文件名，存放在dir指令指定的目录中</span><br><span class="line">appendfsync everysec #aof持久化策略的配置</span><br><span class="line">#no表示由操作系统保证数据同步到磁盘,Linux的默认fsync策略是30秒，最多会丢失30s的数据</span><br><span class="line">#always表示每次写入都执行fsync，以保证数据同步到磁盘,安全性高,性能较差</span><br><span class="line">#everysec表示每秒执行一次fsync，可能会导致丢失这1s数据,此为默认值,也生产建议值</span><br><span class="line">#同时在执行bgrewriteaof操作和主进程写aof文件的操作，两者都会操作磁盘，而bgrewriteaof往往会</span><br><span class="line">涉及大量磁盘操作，这样就会造成主进程在写aof文件的时候出现阻塞的情形,以下参数实现控制</span><br><span class="line">no-appendfsync-on-rewrite no #在aof rewrite期间,是否对aof新记录的append暂缓使用文件同步</span><br><span class="line">策略,主要考虑磁盘IO开支和请求阻塞时间。</span><br><span class="line">#默认为no,表示&quot;不暂缓&quot;,新的aof记录仍然会被立即同步到磁盘，是最安全的方式，不会丢失数据，但是要</span><br><span class="line">忍受阻塞的问题</span><br><span class="line">#为yes,相当于将appendfsync设置为no，这说明并没有执行磁盘操作，只是写入了缓冲区，因此这样并不</span><br><span class="line">会造成阻塞（因为没有竞争磁盘），但是如果这个时候redis挂掉，就会丢失数据。丢失多少数据呢？Linux</span><br><span class="line">的默认fsync策略是30秒，最多会丢失30s的数据,但由于yes性能较好而且会避免出现阻塞因此比较推荐</span><br><span class="line">#rewrite 即对aof文件进行整理,将空闲空间回收,从而可以减少恢复数据时间</span><br><span class="line">auto-aof-rewrite-percentage 100 #当Aof log增长超过指定百分比例时，重写AOF文件，设置为0表</span><br><span class="line">示不自动重写Aof日志，重写是为了使aof体积保持最小，但是还可以确保保存最完整的数据</span><br><span class="line">auto-aof-rewrite-min-size 64mb #触发aof rewrite的最小文件大小</span><br><span class="line">aof-load-truncated yes #是否加载由于某些原因导致的末尾异常的AOF文件(主进程被kill/断电等)，</span><br><span class="line">建议yes</span><br><span class="line">aof-use-rdb-preamble no #redis4.0新增RDB-AOF混合持久化格式，在开启了这个功能之后，AOF重</span><br><span class="line">写产生的文件将同时包含RDB格式的内容和AOF格式的内容，其中RDB格式的内容用于记录已有的数据，而AOF</span><br><span class="line">格式的内容则用于记录最近发生了变化的数据，这样Redis就可以同时兼有RDB持久化和AOF持久化的优点（既</span><br><span class="line">能够快速地生成重写文件，也能够在出现问题时，快速地载入数据）,默认为no,即不启用此功能</span><br><span class="line">lua-time-limit 5000 #lua脚本的最大执行时间，单位为毫秒</span><br><span class="line">cluster-enabled yes #是否开启集群模式，默认不开启,即单机模式</span><br><span class="line">cluster-config-file nodes-6379.conf #由node节点自动生成的集群配置文件名称</span><br><span class="line">cluster-node-timeout 15000 #集群中node节点连接超时时间，单位ms,超过此时间，会踢出集群</span><br><span class="line">cluster-replica-validity-factor 10 #单位为次,在执行故障转移的时候可能有些节点和master断</span><br><span class="line">开一段时间导致数据比较旧，这些节点就不适用于选举为master，超过这个时间的就不会被进行故障转移,不</span><br><span class="line">能当选master，计算公式：(node-timeout * replica-validity-factor) + repl-ping-</span><br><span class="line">replica-period</span><br></pre></td></tr></table></figure>

<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cluster-migration-barrier 1 #集群迁移屏障，一个主节点至少拥有1个正常工作的从节点，即如果主</span><br><span class="line">节点的slave节点故障后会将多余的从节点分配到当前主节点成为其新的从节点。</span><br><span class="line">cluster-require-full-coverage yes #集群请求槽位全部覆盖，如果一个主库宕机且没有备库就会出</span><br><span class="line">现集群槽位不全，那么yes时redis集群槽位验证不全,就不再对外提供服务(对key赋值时,会出现</span><br><span class="line">CLUSTERDOWN The cluster is down的提示,cluster_state:fail,但ping 仍PONG)，而no则可以</span><br><span class="line">继续使用,但是会出现查询数据查不到的情况(因为有数据丢失)。生产建议为no</span><br><span class="line">cluster-replica-no-failover no #如果为yes,此选项阻止在主服务器发生故障时尝试对其主服务器进</span><br><span class="line">行故障转移。 但是，主服务器仍然可以执行手动强制故障转移，一般为no</span><br><span class="line">#Slow log 是 Redis 用来记录超过指定执行时间的日志系统，执行时间不包括与客户端交谈，发送回复等</span><br><span class="line">I/O操作，而是实际执行命令所需的时间（在该阶段线程被阻塞并且不能同时为其它请求提供服务）,由于</span><br><span class="line">slow log 保存在内存里面，读写速度非常快，因此可放心地使用，不必担心因为开启 slow log 而影响</span><br><span class="line">Redis 的速度</span><br><span class="line">slowlog-log-slower-than 10000 #以微秒为单位的慢日志记录，为负数会禁用慢日志，为0会记录每个</span><br><span class="line">命令操作。默认值为10ms,一般一条命令执行都在微秒级,生产建议设为1ms-10ms之间</span><br><span class="line">slowlog-max-len 128 #最多记录多少条慢日志的保存队列长度，达到此长度后，记录新命令会将最旧的命</span><br><span class="line">令从命令队列中删除，以此滚动删除,即,先进先出,队列固定长度,默认128,值偏小,生产建议设为1000以上</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ysocean/p/9074787.html">Redis的配置文件介绍</a> </p>
<h2 id="config-命令实现动态修改配置"><a href="#config-命令实现动态修改配置" class="headerlink" title="config 命令实现动态修改配置"></a>config 命令实现动态修改配置</h2><p>config 命令用于查看当前redis配置、以及不重启redis服务实现动态更改redis配置等<br>注意：不是所有配置都可以动态修改,且此方式无法持久保存</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CONFIG SET parameter value</span><br><span class="line">时间复杂度：O(1)</span><br><span class="line">CONFIG SET 命令可以动态地调整 Redis 服务器的配置(configuration)而无须重启。</span><br><span class="line">可以使用它修改配置参数，或者改变 Redis 的持久化(Persistence)方式。</span><br><span class="line">CONFIG SET 可以修改的配置参数可以使用命令 CONFIG GET * 来列出，所有被 CONFIG SET 修改的配</span><br><span class="line">置参数都会立即生效。</span><br><span class="line">CONFIG GET parameter</span><br><span class="line">时间复杂度： O(N)，其中 N 为命令返回的配置选项数量。</span><br><span class="line">CONFIG GET 命令用于取得运行中的 Redis 服务器的配置参数(configuration parameters)，在</span><br><span class="line">Redis 2.4 版本中， 有部分参数没有办法用 CONFIG GET 访问，但是在最新的 Redis 2.6 版本中，所</span><br><span class="line">有配置参数都已经可以用 CONFIG GET 访问了。</span><br><span class="line">CONFIG GET 接受单个参数 parameter 作为搜索关键字，查找所有匹配的配置参数，其中参数和值以“键-</span><br><span class="line">值对”(key-value pairs)的方式排列。</span><br><span class="line">比如执行 CONFIG GET s* 命令，服务器就会返回所有以 s 开头的配置参数及参数的值：</span><br></pre></td></tr></table></figure>

<h3 id="设置客户端连接密码"><a href="#设置客户端连接密码" class="headerlink" title="设置客户端连接密码"></a>设置客户端连接密码</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#设置连接密码</span><br><span class="line">127.0.0.1:6379&gt; CONFIG SET requirepass 123456</span><br><span class="line">OK</span><br><span class="line">#查看连接密码</span><br><span class="line">127.0.0.1:6379&gt; CONFIG GET requirepass</span><br><span class="line">1) &quot;requirepass&quot;</span><br><span class="line">2) &quot;123456&quot;</span><br></pre></td></tr></table></figure>

<h3 id="获取当前配置"><a href="#获取当前配置" class="headerlink" title="获取当前配置"></a>获取当前配置</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#奇数行为键，偶数行为值</span><br><span class="line">127.0.0.1:6379&gt; CONFIG GET *</span><br><span class="line">1) &quot;dbfilename&quot;</span><br><span class="line">2) &quot;dump.rdb&quot;</span><br><span class="line">3) &quot;requirepass&quot;</span><br><span class="line">4) &quot;&quot;</span><br><span class="line">5) &quot;masterauth&quot;</span><br><span class="line">6) &quot;&quot;</span><br><span class="line">7) &quot;cluster-announce-ip&quot;</span><br><span class="line">8) &quot;&quot;</span><br><span class="line">9) &quot;unixsocket&quot;</span><br><span class="line">10) &quot;&quot;</span><br><span class="line">11) &quot;logfile&quot;</span><br><span class="line">12) &quot;/var/log/redis/redis.log&quot;</span><br><span class="line">13) &quot;pidfile&quot;</span><br><span class="line">14) &quot;/var/run/redis_6379.pid&quot;</span><br><span class="line">15) &quot;slave-announce-ip&quot;</span><br><span class="line">16) &quot;&quot;</span><br><span class="line">17) &quot;replica-announce-ip&quot;</span><br><span class="line">18) &quot;&quot;</span><br><span class="line">19) &quot;maxmemory&quot;</span><br><span class="line">20) &quot;0&quot;</span><br><span class="line">......</span><br><span class="line">#查看bind</span><br><span class="line">127.0.0.1:6379&gt; CONFIG GET bind</span><br><span class="line">1) &quot;bind&quot;</span><br><span class="line">2) &quot;0.0.0.0&quot;</span><br><span class="line">#Redis5.0有些设置无法修改,Redis6.2.6版本支持修改bind</span><br><span class="line">127.0.0.1:6379&gt; CONFIG SET bind 127.0.0.1</span><br><span class="line">(error) ERR Unsupported CONFIG parameter: bind</span><br></pre></td></tr></table></figure>

<h3 id="设置Redis使用的最大内存量"><a href="#设置Redis使用的最大内存量" class="headerlink" title="设置Redis使用的最大内存量"></a>设置Redis使用的最大内存量</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; CONFIG SET maxmemory 8589934592</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; CONFIG GET maxmemory</span><br><span class="line">1) &quot;maxmemory&quot;</span><br><span class="line">2) &quot;8589934592&quot;</span><br></pre></td></tr></table></figure>



<h3 id="慢查询"><a href="#慢查询" class="headerlink" title="慢查询"></a>慢查询</h3><p>范例：SLOW LOG</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/redis.conf</span><br><span class="line">slowlog-log-slower-than 1 #指定超过1us即为慢的指令，默认值为10000us</span><br><span class="line">slowlog-max-len 1024 #指定只保存最近的1024条慢记录，默认值为128</span><br><span class="line">127.0.0.1:6379&gt; SLOWLOG LEN #查看慢日志的记录条数</span><br><span class="line">(integer) 14</span><br><span class="line">127.0.0.1:6379&gt; SLOWLOG GET [n] #查看慢日志的n条记录</span><br><span class="line">1) 1) (integer) 14</span><br><span class="line">2) (integer) 1544690617</span><br><span class="line">3) (integer) 4 #第3)行表示每条指令的执行时长</span><br><span class="line">4) 1) &quot;slowlog&quot;</span><br><span class="line">127.0.0.1:6379&gt; SLOWLOG GET 3</span><br><span class="line">1) 1) (integer) 7</span><br><span class="line">2) (integer) 1602901545</span><br><span class="line">3) (integer) 26</span><br><span class="line">4) 1) &quot;SLOWLOG&quot;</span><br><span class="line">2) &quot;get&quot;</span><br><span class="line">5) &quot;127.0.0.1:38258&quot;</span><br><span class="line">6) &quot;&quot;</span><br><span class="line">2) 1) (integer) 6</span><br><span class="line">2) (integer) 1602901540</span><br><span class="line">3) (integer) 22</span><br><span class="line">4) 1) &quot;SLOWLOG&quot;</span><br><span class="line">2) &quot;get&quot;</span><br><span class="line">3) &quot;2&quot;</span><br><span class="line">5) &quot;127.0.0.1:38258&quot;</span><br><span class="line">6) &quot;&quot;</span><br><span class="line">3) 1) (integer) 5</span><br><span class="line">2) (integer) 1602901497</span><br><span class="line">3) (integer) 22</span><br><span class="line">4) 1) &quot;SLOWLOG&quot;</span><br><span class="line">2) &quot;GET&quot;</span><br><span class="line">5) &quot;127.0.0.1:38258&quot;</span><br><span class="line">6) &quot;&quot;</span><br><span class="line">127.0.0.1:6379&gt; SLOWLOG RESET #清空慢日志</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<h3 id="Redis持久化"><a href="#Redis持久化" class="headerlink" title="Redis持久化"></a>Redis持久化</h3><p><img src="/../image.assets/1670853239934.png" alt="1670853239934"></p>
<h4 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h4><p>RDB 工作原理</p>
<p><img src="/../image.assets/1670853325839.png" alt="1670853325839"></p>
<p><img src="/../image.assets/1670853341364.png" alt="1670853341364"></p>
<p><img src="/../image.assets/1670853373976.png" alt="1670853373976"></p>
<p><img src="/../image.assets/1670853388030.png" alt="1670853388030"></p>
<p><img src="/../image.assets/1670853405541.png" alt="1670853405541"></p>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p><img src="/../image.assets/1670853437912.png" alt="1670853437912"></p>
<p><img src="/../image.assets/1670853466251.png" alt="1670853466251"></p>
<p><img src="/../image.assets/1670853480093.png" alt="1670853480093"></p>
<h4 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h4><p><img src="/../image.assets/1670853532980.png" alt="1670853532980"></p>
<p><img src="/../image.assets/1670853557144.png" alt="1670853557144"></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/search/">搜索</a></li>
         
          <li><a href="/about/">关于</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">Redis基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%80%A7"><span class="toc-number">1.2.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E7%BA%BF%E7%A8%8B"><span class="toc-number">1.3.</span> <span class="toc-text">单线程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.4.</span> <span class="toc-text">常见应用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%B5%81%E7%A8%8B"><span class="toc-number">1.5.</span> <span class="toc-text">缓存的实现流程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E5%AE%89%E8%A3%85%E5%8F%8A%E8%BF%9E%E6%8E%A5"><span class="toc-number">2.</span> <span class="toc-text">Redis安装及连接</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#yum%E5%AE%89%E8%A3%85"><span class="toc-number">2.1.</span> <span class="toc-text">yum安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85"><span class="toc-number">2.2.</span> <span class="toc-text">编译安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E5%A4%9A%E5%AE%9E%E4%BE%8B"><span class="toc-number">2.3.</span> <span class="toc-text">Redis多实例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86"><span class="toc-number">3.</span> <span class="toc-text">Redis 配置管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E"><span class="toc-number">3.1.</span> <span class="toc-text">配置文件说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#config-%E5%91%BD%E4%BB%A4%E5%AE%9E%E7%8E%B0%E5%8A%A8%E6%80%81%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.</span> <span class="toc-text">config 命令实现动态修改配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5%E5%AF%86%E7%A0%81"><span class="toc-number">3.2.1.</span> <span class="toc-text">设置客户端连接密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.2.</span> <span class="toc-text">获取当前配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AERedis%E4%BD%BF%E7%94%A8%E7%9A%84%E6%9C%80%E5%A4%A7%E5%86%85%E5%AD%98%E9%87%8F"><span class="toc-number">3.2.3.</span> <span class="toc-text">设置Redis使用的最大内存量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.2.4.</span> <span class="toc-text">慢查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">3.2.5.</span> <span class="toc-text">Redis持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RDB"><span class="toc-number">3.2.5.1.</span> <span class="toc-text">RDB</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.5.2.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF"><span class="toc-number">3.2.5.3.</span> <span class="toc-text">AOF</span></a></li></ol></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/&text=Redis部署和基础使用"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/&title=Redis部署和基础使用"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/&is_video=false&description=Redis部署和基础使用"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Redis部署和基础使用&body=Check out this article: http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/&title=Redis部署和基础使用"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/&title=Redis部署和基础使用"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/&title=Redis部署和基础使用"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/&title=Redis部署和基础使用"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/&name=Redis部署和基础使用&description=Redis (Remote Dictionary Server远程字典服务)是一个遵循BSD MIT开源协议的高性能的NoSQL"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/&t=Redis部署和基础使用"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2022-2023
    yuan kun
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     -->
      </ul>
    </nav>
<!--<p class="size-small">
    <a href="http://www.beian.miit.gov.cn" target="_blank" rel="noopener">黔ICP备2022006994号</a>
  </p>-->
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
